<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Receiving Page</title>
    <script src="peerjs.min.js"></script>
    <style type="text/css">
        span {
            color: red;
        }

        .noActive {
            background-color: gray;
        }

        .active {
            background-color: green;
        }

        .active2 {
            background-color: red;
        }
    </style>
</head>

<body>
    <p>
        <h3>My ID: </h3>
        <span id='myid' style="font-weight: bold; font-size: 30px;"></span>
    </p>
    <br>
    <div id=callinfo>
        Входящий звонок
        <button onclick='callanswer()' id="btn" class="noActive">Принять</button>
        <button onclick='callcancel()' id="btn2" class="noActive">Отклонить</button>
    </div>
    <video id="remVideo" min-width="1080px" controls autoplay muted="false" volume=0></video>
    <script>
        var peer = new Peer();

        var btn = document.getElementById("btn");
        var btn2 = document.getElementById("btn2");

        function fullScreen(element) {
            if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.webkitrequestFullscreen) {
                element.webkitRequestFullscreen();
            } else if (element.mozRequestFullscreen) {
                element.mozRequestFullScreen();
            }
        };

        peer.on('open', function (peerID) {
            document.getElementById('myid').innerHTML = peerID;
        });
        var peercall;
        peer.on('call', function (call) {
            // Answer the call, providing our mediaStream
            peercall = call;

            //изменение состояния кнопок
            btn.classList.remove('noActive');
            btn2.classList.remove('noActive');
            btn.classList.add('active');
            btn2.classList.add('active2');

        });

        function callanswer() {
            peercall.answer(); // отвечаем на звонок и передаем свой медиапоток собеседнику
            document.getElementById('callinfo').innerHTML =
                "Звонок начат... <button onclick='callclose()' >Завершить звонок</button>"; //информируем, что звонок начат, и выводим кнопку Завершить
            setTimeout(function () {
                //разворачиваем окно плеера на весь экран
                var wind = document.getElementById('remVideo');
                fullScreen(wind);

                //входящий стрим помещаем в объект видео для отображения
                document.getElementById('remVideo').srcObject = peercall.remoteStream;
                document.getElementById('remVideo').onloadedmetadata = function (e) {
                    // и запускаем воспроизведение когда объект загружен
                    document.getElementById('remVideo').play();
                };
            }, 1500);
        };
    </script>
</body>

</html>